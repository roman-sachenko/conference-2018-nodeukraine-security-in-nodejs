#!/bin/bash

# Node.js Security Vulnerabilities Demo - Interactive Exploit Menu

BASE_URL=${BASE_URL:-"http://localhost:3000"}

echo "🚀 Node.js Security Vulnerabilities Demo"
echo "📍 Target: $BASE_URL"
echo ""

# Check if target is accessible
if ! curl -s "$BASE_URL/check/rate" > /dev/null 2>&1; then
    echo "❌ Target $BASE_URL is not accessible!"
    echo "   Make sure the application is running with: make run"
    echo ""
    exit 1
fi

echo "✅ Target is accessible!"
echo ""

while true; do
    echo "🔓 Available Exploits:"
    echo "  1) Run All Exploits"
    echo "  2) Brute Force Attack"
    echo "  3) Database Injection"
    echo "  4) ReDoS Attack"
    echo "  5) Memory Leak"
    echo "  6) Timing Attack"
    echo "  7) Change Target URL"
    echo "  8) Exit"
    echo ""
    read -p "Select an option (1-8): " choice
    
    case $choice in
        1)
            echo "🚀 Running all exploits..."
            echo ""
            echo "🔓 Running brute force attack..."
            BASE_URL="$BASE_URL" node scripts/exploit-brute-force.js
            echo ""
            echo "💉 Running database injection attack..."
            BASE_URL="$BASE_URL" node scripts/exploit-db-injection.js
            echo ""
            echo "⏰ Running ReDoS attack..."
            BASE_URL="$BASE_URL" node scripts/exploit-redos.js
            echo ""
            echo "💾 Running memory leak attack..."
            BASE_URL="$BASE_URL" node scripts/exploit-memory-leak.js
            echo ""
            echo "⏱️ Running timing attack..."
            BASE_URL="$BASE_URL" node scripts/exploit-timing.js
            ;;
        2)
            echo "🔓 Running brute force attack..."
            BASE_URL="$BASE_URL" node scripts/exploit-brute-force.js
            ;;
        3)
            echo "💉 Running database injection attack..."
            BASE_URL="$BASE_URL" node scripts/exploit-db-injection.js
            ;;
        4)
            echo "⏰ Running ReDoS attack..."
            BASE_URL="$BASE_URL" node scripts/exploit-redos.js
            ;;
        5)
            echo "💾 Running memory leak attack..."
            BASE_URL="$BASE_URL" node scripts/exploit-memory-leak.js
            ;;
        6)
            echo "⏱️ Running timing attack..."
            BASE_URL="$BASE_URL" node scripts/exploit-timing.js
            ;;
        7)
            read -p "Enter new target URL: " new_url
            BASE_URL="$new_url"
            echo "📍 Target changed to: $BASE_URL"
            
            # Test new target
            if curl -s "$BASE_URL/check/rate" > /dev/null 2>&1; then
                echo "✅ New target is accessible!"
            else
                echo "❌ New target is not accessible!"
            fi
            ;;
        8)
            echo "👋 Goodbye!"
            exit 0
            ;;
        *)
            echo "❌ Invalid option. Please select 1-8."
            ;;
    esac
    
    echo ""
    echo "Press Enter to continue..."
    read
    clear
    
    echo "🚀 Node.js Security Vulnerabilities Demo"
    echo "📍 Target: $BASE_URL"
    echo ""
done
