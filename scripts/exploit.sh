#!/bin/bash

# Node.js Security Vulnerabilities Demo - Interactive Exploit Menu

BASE_URL=${BASE_URL:-"http://localhost:3000"}

echo "ğŸš€ Node.js Security Vulnerabilities Demo"
echo "ğŸ“ Target: $BASE_URL"
echo ""

# Check if target is accessible
if ! curl -s "$BASE_URL/check/rate" > /dev/null 2>&1; then
    echo "âŒ Target $BASE_URL is not accessible!"
    echo "   Make sure the application is running with: make run"
    echo ""
    exit 1
fi

echo "âœ… Target is accessible!"
echo ""

while true; do
    echo "ğŸ”“ Available Exploits:"
    echo "  1) Run All Exploits"
    echo "  2) Brute Force Attack"
    echo "  3) Database Injection"
    echo "  4) ReDoS Attack"
    echo "  5) Memory Leak"
    echo "  6) Timing Attack"
    echo "  7) Change Target URL"
    echo "  8) Exit"
    echo ""
    read -p "Select an option (1-8): " choice
    
    case $choice in
        1)
            echo "ğŸš€ Running all exploits..."
            echo ""
            echo "ğŸ”“ Running brute force attack..."
            BASE_URL="$BASE_URL" node scripts/exploit-brute-force.js
            echo ""
            echo "ğŸ’‰ Running database injection attack..."
            BASE_URL="$BASE_URL" node scripts/exploit-db-injection.js
            echo ""
            echo "â° Running ReDoS attack..."
            BASE_URL="$BASE_URL" node scripts/exploit-redos.js
            echo ""
            echo "ğŸ’¾ Running memory leak attack..."
            BASE_URL="$BASE_URL" node scripts/exploit-memory-leak.js
            echo ""
            echo "â±ï¸ Running timing attack..."
            BASE_URL="$BASE_URL" node scripts/exploit-timing.js
            ;;
        2)
            echo "ğŸ”“ Running brute force attack..."
            BASE_URL="$BASE_URL" node scripts/exploit-brute-force.js
            ;;
        3)
            echo "ğŸ’‰ Running database injection attack..."
            BASE_URL="$BASE_URL" node scripts/exploit-db-injection.js
            ;;
        4)
            echo "â° Running ReDoS attack..."
            BASE_URL="$BASE_URL" node scripts/exploit-redos.js
            ;;
        5)
            echo "ğŸ’¾ Running memory leak attack..."
            BASE_URL="$BASE_URL" node scripts/exploit-memory-leak.js
            ;;
        6)
            echo "â±ï¸ Running timing attack..."
            BASE_URL="$BASE_URL" node scripts/exploit-timing.js
            ;;
        7)
            read -p "Enter new target URL: " new_url
            BASE_URL="$new_url"
            echo "ğŸ“ Target changed to: $BASE_URL"
            
            # Test new target
            if curl -s "$BASE_URL/check/rate" > /dev/null 2>&1; then
                echo "âœ… New target is accessible!"
            else
                echo "âŒ New target is not accessible!"
            fi
            ;;
        8)
            echo "ğŸ‘‹ Goodbye!"
            exit 0
            ;;
        *)
            echo "âŒ Invalid option. Please select 1-8."
            ;;
    esac
    
    echo ""
    echo "Press Enter to continue..."
    read
    clear
    
    echo "ğŸš€ Node.js Security Vulnerabilities Demo"
    echo "ğŸ“ Target: $BASE_URL"
    echo ""
done
